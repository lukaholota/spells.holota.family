<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 5e Character Creator (UA)</title>
    <!-- Підключення Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Підключення шрифтів -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Кастомні стилі для теми */
        body {
            font-family: 'Merriweather', serif;
            background-image: url('https://www.transparenttextures.com/patterns/dark-leather.png');
            background-color: #1a1a1a;
        }
        .parchment {
            background-color: #fdf5e6; /* Колір пергаменту */
            border: 2px solid #8B4513; /* Коричнева рамка */
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        .header-font {
            font-family: 'Marck Script', cursive;
        }
        /* Стилізація полів вибору */
        select, input[type="text"] {
            background-color: #fff8eb;
            border: 1px solid #c8a87a;
            border-radius: 4px;
            padding: 8px;
            transition: all 0.3s ease;
        }
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #8B4513;
            box-shadow: 0 0 5px rgba(139, 69, 19, 0.5);
        }
        /* Стилізація кнопок */
        .btn {
            background-color: #8B4513; /* Насичений коричневий */
            color: #fdf5e6;
            padding: 10px 20px;
            border-radius: 5px;
            border-bottom: 3px solid #5a2d0c;
            font-weight: bold;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #a0522d;
            transform: translateY(-2px);
            border-bottom-width: 5px;
        }
        .btn:active {
            transform: translateY(1px);
            border-bottom-width: 2px;
        }
        .btn-secondary {
            background-color: #6c757d;
            border-bottom-color: #494f54;
        }
        .btn-secondary:hover {
            background-color: #868e96;
        }
        /* Анімація появи кроків */
        .step {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Стилізація радіо кнопок для світогляду */
        .alignment-grid input[type="radio"] {
            opacity: 0;
            position: fixed;
            width: 0;
        }
        .alignment-grid label {
            display: inline-block;
            padding: 10px 15px;
            border: 2px solid #c8a87a;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .alignment-grid input[type="radio"]:checked + label {
            background-color: #8B4513;
            color: white;
            border-color: #5a2d0c;
        }
        .ability-score-box {
            border: 2px dashed #c8a87a;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-800 p-4 sm:p-8">

<div id="character-creator" class="max-w-4xl mx-auto parchment rounded-lg p-6 sm:p-10">
    <h1 class="text-4xl sm:text-5xl text-center text-amber-900 header-font mb-2">Створення Персонажа D&D 5e</h1>
    <p class="text-center text-gray-600 mb-8">Пройдіть кроки, щоб створити свого унікального героя!</p>

    <!-- Крок 1: Раса та Клас -->
    <div id="step-1" class="step active">
        <h2 class="text-2xl text-amber-800 border-b-2 border-amber-800 pb-2 mb-6">Крок 1: Раса та Клас</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="race-select" class="block font-bold mb-2">Оберіть Расу:</label>
                <select id="race-select" class="w-full"></select>
            </div>
            <div>
                <label for="class-select" class="block font-bold mb-2">Оберіть Клас:</label>
                <select id="class-select" class="w-full"></select>
            </div>
        </div>
        <div class="mt-8 text-right">
            <button onclick="nextStep()" class="btn">Далі</button>
        </div>
    </div>

    <!-- Крок 2: Характеристики -->
    <div id="step-2" class="step">
        <h2 class="text-2xl text-amber-800 border-b-2 border-amber-800 pb-2 mb-4">Крок 2: Розподіл Характеристик</h2>
        <p class="text-gray-600 mb-6">Розподіліть стандартні значення (15, 14, 13, 12, 10, 8) між вашими характеристиками.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Ліва колонка -->
            <div id="ability-scores-container" class="space-y-4"></div>
            <!-- Права колонка -->
            <div class="flex flex-col items-center justify-center p-4 ability-score-box rounded-lg">
                <h3 class="font-bold text-lg mb-4">Доступні значення:</h3>
                <div id="available-scores" class="flex flex-wrap gap-2 justify-center"></div>
            </div>
        </div>
        <div class="mt-8 flex justify-between">
            <button onclick="prevStep()" class="btn btn-secondary">Назад</button>
            <button onclick="nextStep()" class="btn">Далі</button>
        </div>
    </div>

    <!-- Крок 3: Передісторія та Світогляд -->
    <div id="step-3" class="step">
        <h2 class="text-2xl text-amber-800 border-b-2 border-amber-800 pb-2 mb-6">Крок 3: Передісторія та Світогляд</h2>
        <div>
            <label for="background-select" class="block font-bold mb-2">Оберіть Передісторію:</label>
            <select id="background-select" class="w-full"></select>
        </div>
        <div class="mt-6">
            <h3 class="font-bold mb-2">Оберіть Світогляд:</h3>
            <div id="alignment-grid" class="alignment-grid grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
        </div>
        <div class="mt-8 flex justify-between">
            <button onclick="prevStep()" class="btn btn-secondary">Назад</button>
            <button onclick="nextStep()" class="btn">Далі</button>
        </div>
    </div>

    <!-- Крок 4: Деталі персонажа -->
    <div id="step-4" class="step">
        <h2 class="text-2xl text-amber-800 border-b-2 border-amber-800 pb-2 mb-6">Крок 4: Деталі Персонажа</h2>
        <div class="space-y-4">
            <div>
                <label for="character-name" class="block font-bold mb-2">Ім'я Персонажа:</label>
                <input type="text" id="character-name" placeholder="Наприклад, Арагорн" class="w-full">
            </div>
            <div>
                <label for="personality-traits" class="block font-bold mb-2">Риси характеру:</label>
                <input type="text" id="personality-traits" placeholder="Що робить вашого персонажа унікальним?" class="w-full">
            </div>
            <div>
                <label for="ideals" class="block font-bold mb-2">Ідеали:</label>
                <input type="text" id="ideals" placeholder="У що вірить ваш персонаж?" class="w-full">
            </div>
            <div>
                <label for="bonds" class="block font-bold mb-2">Прив'язаності:</label>
                <input type="text" id="bonds" placeholder="Що важливо для вашого персонажа?" class="w-full">
            </div>
            <div>
                <label for="flaws" class="block font-bold mb-2">Слабкості:</label>
                <input type="text" id="flaws" placeholder="Які недоліки має ваш персонаж?" class="w-full">
            </div>
        </div>
        <div class="mt-8 flex justify-between">
            <button onclick="prevStep()" class="btn btn-secondary">Назад</button>
            <button onclick="showFinalSheet()" class="btn">Завершити</button>
        </div>
    </div>

</div>

<!-- Фінальний аркуш персонажа -->
<div id="character-sheet" class="hidden max-w-4xl mx-auto parchment rounded-lg p-6 sm:p-10 mt-8">
    <h1 id="sheet-name" class="text-4xl text-center text-amber-900 header-font mb-4">Аркуш Персонажа</h1>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center border-b-2 border-amber-800 pb-4 mb-4">
        <div><strong class="block">Раса:</strong> <span id="sheet-race"></span></div>
        <div><strong class="block">Клас:</strong> <span id="sheet-class"></span></div>
        <div><strong class="block">Передісторія:</strong> <span id="sheet-background"></span></div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Ліва колонка -->
        <div>
            <h2 class="text-2xl text-amber-800 mb-4">Характеристики</h2>
            <div id="sheet-abilities" class="grid grid-cols-2 gap-4"></div>
        </div>
        <!-- Права колонка -->
        <div>
            <h2 class="text-2xl text-amber-800 mb-4">Основні Показники</h2>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="p-3 bg-white/50 rounded-lg">
                    <div class="font-bold text-lg" id="sheet-ac">10</div>
                    <div>Клас Броні</div>
                </div>
                <div class="p-3 bg-white/50 rounded-lg">
                    <div class="font-bold text-lg" id="sheet-hp">8</div>
                    <div>Пункти Здоров'я</div>
                </div>
                <div class="p-3 bg-white/50 rounded-lg">
                    <div class="font-bold text-lg" id="sheet-initiative">+0</div>
                    <div>Ініціатива</div>
                </div>
                <div class="p-3 bg-white/50 rounded-lg">
                    <div class="font-bold text-lg" id="sheet-proficiency">+2</div>
                    <div>Бонус Майстерності</div>
                </div>
            </div>
            <div class="mt-6">
                <h3 class="text-xl text-amber-800 mb-2">Світогляд</h3>
                <p id="sheet-alignment" class="text-lg"></p>
            </div>
        </div>
    </div>
    <div class="mt-6 border-t-2 border-amber-800 pt-4">
        <h2 class="text-2xl text-amber-800 mb-4">Особистість</h2>
        <div class="space-y-3 bg-white/30 p-4 rounded-lg">
            <p><strong>Риси характеру:</strong> <span id="sheet-personality"></span></p>
            <p><strong>Ідеали:</strong> <span id="sheet-ideals"></span></p>
            <p><strong>Прив'язаності:</strong> <span id="sheet-bonds"></span></p>
            <p><strong>Слабкості:</strong> <span id="sheet-flaws"></span></p>
        </div>
    </div>

    <div class="text-center mt-8">
        <button onclick="startOver()" class="btn">Створити нового персонажа</button>
    </div>
</div>


<script>
    // --- БАЗА ДАНИХ ГРИ ---
    const DND_DATA = {
        races: [
            { name: "Людина", ability_bonus: { str: 1, dex: 1, con: 1, int: 1, wis: 1, cha: 1 } },
            { name: "Ельф", ability_bonus: { dex: 2 } },
            { name: "Дворф", ability_bonus: { con: 2 } },
            { name: "Напіврослик", ability_bonus: { dex: 2 } },
            { name: "Дракононароджений", ability_bonus: { str: 2, cha: 1 } },
            { name: "Гном", ability_bonus: { int: 2 } },
            { name: "Напівельф", ability_bonus: { cha: 2 }, note: "та +1 до двох інших на вибір" },
            { name: "Напіворк", ability_bonus: { str: 2, con: 1 } },
            { name: "Тифлінг", ability_bonus: { int: 1, cha: 2 } }
        ],
        classes: [
            { name: "Варвар", hit_die: 12 },
            { name: "Бард", hit_die: 8 },
            { name: "Жрець", hit_die: 8 },
            { name: "Друїд", hit_die: 8 },
            { name: "Воїн", hit_die: 10 },
            { name: "Монах", hit_die: 8 },
            { name: "Паладин", hit_die: 10 },
            { name: "Слідопит", hit_die: 10 },
            { name: "Плут", hit_die: 8 },
            { name: "Чаклун", hit_die: 6 },
            { name: "Чорнокнижник", hit_die: 8 },
            { name: "Маг", hit_die: 6 },
        ],
        abilities: [
            { id: "str", name: "Сила" },
            { id: "dex", name: "Спритність" },
            { id: "con", name: "Статура" },
            { id: "int", name: "Інтелект" },
            { id: "wis", name: "Мудрість" },
            { id: "cha", name: "Харизма" }
        ],
        backgrounds: [
            "Послушник", "Шарлатан", "Злочинець", "Артист", "Народний герой",
            "Ремісник гільдії", "Відлюдник", "Дворянин", "Чужинець",
            "Мудрець", "Моряк", "Солдат", "Безпритульний"
        ],
        alignments: [
            "Законно-Добрий", "Нейтрально-Добрий", "Хаотично-Добрий",
            "Законно-Нейтральний", "Істинно-Нейтральний", "Хаотично-Нейтральний",
            "Законно-Злий", "Нейтрально-Злий", "Хаотично-Злий"
        ]
    };

    const STANDARD_ARRAY = [15, 14, 13, 12, 10, 8];

    // --- СТАН ЗАСТОСУНКУ ---
    let currentStep = 1;
    let character = {};

    // --- ІНІЦІАЛІЗАЦІЯ ---
    document.addEventListener('DOMContentLoaded', () => {
        populateSelects();
        setupAbilityScoresStep();
        populateAlignments();
    });

    function populateSelects() {
        const raceSelect = document.getElementById('race-select');
        const classSelect = document.getElementById('class-select');
        const backgroundSelect = document.getElementById('background-select');

        DND_DATA.races.forEach(race => {
            const option = document.createElement('option');
            option.value = race.name;
            option.textContent = race.name + (race.note ? ` (${race.note})` : '');
            raceSelect.appendChild(option);
        });

        DND_DATA.classes.forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.name;
            option.textContent = cls.name;
            classSelect.appendChild(option);
        });

        DND_DATA.backgrounds.forEach(bg => {
            const option = document.createElement('option');
            option.value = bg;
            option.textContent = bg;
            backgroundSelect.appendChild(option);
        });
    }

    function populateAlignments() {
        const grid = document.getElementById('alignment-grid');
        DND_DATA.alignments.forEach((alignment, index) => {
            const id = `alignment-${index}`;
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.id = id;
            radio.name = 'alignment';
            radio.value = alignment;
            if (index === 4) radio.checked = true; // Істинно-Нейтральний за замовчуванням

            const label = document.createElement('label');
            label.htmlFor = id;
            label.textContent = alignment;

            grid.appendChild(radio);
            grid.appendChild(label);
        });
    }

    function setupAbilityScoresStep() {
        const container = document.getElementById('ability-scores-container');
        const availableContainer = document.getElementById('available-scores');
        container.innerHTML = '';
        availableContainer.innerHTML = '';

        // Створюємо поля для вибору значень
        DND_DATA.abilities.forEach(ability => {
            const div = document.createElement('div');
            div.className = 'flex items-center gap-4';

            const label = document.createElement('label');
            label.htmlFor = `ability-${ability.id}`;
            label.textContent = ability.name + ':';
            label.className = 'w-1/3 font-bold';

            const select = document.createElement('select');
            select.id = `ability-${ability.id}`;
            select.className = 'w-2/3 ability-select';

            const defaultOption = document.createElement('option');
            defaultOption.value = "";
            defaultOption.textContent = "Обрати...";
            select.appendChild(defaultOption);

            STANDARD_ARRAY.forEach(score => {
                const option = document.createElement('option');
                option.value = score;
                option.textContent = score;
                select.appendChild(option);
            });

            div.appendChild(label);
            div.appendChild(select);
            container.appendChild(div);
        });

        updateAvailableScores();

        // Додаємо слухачів для оновлення доступних значень
        document.querySelectorAll('.ability-select').forEach(select => {
            select.addEventListener('change', updateAvailableScores);
        });
    }

    function updateAvailableScores() {
        const availableContainer = document.getElementById('available-scores');
        const selects = document.querySelectorAll('.ability-select');
        let usedScores = Array.from(selects).map(s => s.value).filter(v => v !== "");

        let availableScores = STANDARD_ARRAY.filter(s => !usedScores.includes(s.toString()));

        availableContainer.innerHTML = '';
        STANDARD_ARRAY.forEach(score => {
            const scoreEl = document.createElement('span');
            scoreEl.textContent = score;
            scoreEl.className = 'p-2 rounded text-lg font-bold';
            if (usedScores.includes(score.toString())) {
                scoreEl.className += ' bg-gray-300 text-gray-500 line-through';
            } else {
                scoreEl.className += ' bg-amber-200 text-amber-900';
            }
            availableContainer.appendChild(scoreEl);
        });

        // Оновлення опцій в інших селектах
        selects.forEach(currentSelect => {
            const currentVal = currentSelect.value;
            Array.from(currentSelect.options).forEach(option => {
                if(option.value === "") return;
                const isUsedElsewhere = usedScores.some(used => used === option.value && used !== currentVal);
                option.disabled = isUsedElsewhere;
            });
        });
    }


    // --- НАВІГАЦІЯ ---
    function nextStep() {
        if (currentStep === 2) {
            // Валідація характеристик
            const selects = document.querySelectorAll('.ability-select');
            const allAssigned = Array.from(selects).every(s => s.value !== "");
            if (!allAssigned) {
                alert("Будь ласка, розподіліть усі значення характеристик.");
                return;
            }
        }

        if (currentStep < 4) {
            document.getElementById(`step-${currentStep}`).classList.remove('active');
            currentStep++;
            document.getElementById(`step-${currentStep}`).classList.add('active');
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            document.getElementById(`step-${currentStep}`).classList.remove('active');
            currentStep--;
            document.getElementById(`step-${currentStep}`).classList.add('active');
        }
    }

    // --- ФІНАЛІЗАЦІЯ ---
    function showFinalSheet() {
        if (document.getElementById('character-name').value.trim() === '') {
            alert("Будь ласка, введіть ім'я персонажа.");
            return;
        }
        collectCharacterData();
        renderCharacterSheet();
        document.getElementById('character-creator').classList.add('hidden');
        document.getElementById('character-sheet').classList.remove('hidden');
    }

    function collectCharacterData() {
        // Крок 1
        const raceName = document.getElementById('race-select').value;
        const className = document.getElementById('class-select').value;
        character.race = DND_DATA.races.find(r => r.name === raceName);
        character.class = DND_DATA.classes.find(c => c.name === className);

        // Крок 2
        character.base_abilities = {};
        DND_DATA.abilities.forEach(ability => {
            character.base_abilities[ability.id] = parseInt(document.getElementById(`ability-${ability.id}`).value);
        });

        // Крок 3
        character.background = document.getElementById('background-select').value;
        character.alignment = document.querySelector('input[name="alignment"]:checked').value;

        // Крок 4
        character.name = document.getElementById('character-name').value;
        character.personality = document.getElementById('personality-traits').value;
        character.ideals = document.getElementById('ideals').value;
        character.bonds = document.getElementById('bonds').value;
        character.flaws = document.getElementById('flaws').value;
    }

    function getModifier(score) {
        return Math.floor((score - 10) / 2);
    }

    function renderCharacterSheet() {
        // Ім'я, Раса, Клас, Передісторія
        document.getElementById('sheet-name').textContent = character.name || "Аркуш Персонажа";
        document.getElementById('sheet-race').textContent = character.race.name;
        document.getElementById('sheet-class').textContent = character.class.name;
        document.getElementById('sheet-background').textContent = character.background;
        document.getElementById('sheet-alignment').textContent = character.alignment;

        // Характеристики
        const abilitiesContainer = document.getElementById('sheet-abilities');
        abilitiesContainer.innerHTML = '';
        character.final_abilities = {};

        DND_DATA.abilities.forEach(ability => {
            const baseScore = character.base_abilities[ability.id];
            const racialBonus = character.race.ability_bonus[ability.id] || 0;
            const totalScore = baseScore + racialBonus;
            character.final_abilities[ability.id] = totalScore;

            const modifier = getModifier(totalScore);
            const sign = modifier >= 0 ? "+" : "";

            const abilityEl = document.createElement('div');
            abilityEl.className = 'p-3 bg-white/50 rounded-lg text-center';
            abilityEl.innerHTML = `
                    <div class="font-bold">${ability.name}</div>
                    <div class="text-3xl font-bold text-amber-900">${totalScore}</div>
                    <div class="text-lg font-bold">${sign}${modifier}</div>
                `;
            abilitiesContainer.appendChild(abilityEl);
        });

        // Розрахунок основних показників
        const dexMod = getModifier(character.final_abilities.dex);
        const conMod = getModifier(character.final_abilities.con);

        const ac = 10 + dexMod;
        const hp = character.class.hit_die + conMod;

        document.getElementById('sheet-ac').textContent = ac;
        document.getElementById('sheet-hp').textContent = hp;
        document.getElementById('sheet-initiative').textContent = (dexMod >= 0 ? "+" : "") + dexMod;

        // Деталі
        document.getElementById('sheet-personality').textContent = character.personality || "Не вказано";
        document.getElementById('sheet-ideals').textContent = character.ideals || "Не вказано";
        document.getElementById('sheet-bonds').textContent = character.bonds || "Не вказано";
        document.getElementById('sheet-flaws').textContent = character.flaws || "Не вказано";
    }

    function startOver() {
        character = {};
        currentStep = 1;

        // Скидання полів вводу
        document.getElementById('character-name').value = '';
        document.getElementById('personality-traits').value = '';
        document.getElementById('ideals').value = '';
        document.getElementById('bonds').value = '';
        document.getElementById('flaws').value = '';

        document.querySelectorAll('.ability-select').forEach(s => s.value = "");
        updateAvailableScores();

        // Показ першого кроку
        document.getElementById('character-sheet').classList.add('hidden');
        document.getElementById('character-creator').classList.remove('hidden');
        document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
        document.getElementById('step-1').classList.add('active');
    }

</script>
</body>
</html>
